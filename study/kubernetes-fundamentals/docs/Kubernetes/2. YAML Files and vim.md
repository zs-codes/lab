## Core Principle

**All Kubernetes objects are defined as YAML (or JSON) files**

YAML manifests are the declarative way to define desired state in Kubernetes.

---

## Viewing YAML Definitions

### Get Existing Pod YAML

```bash
# Get full YAML definition of a running pod
k get pod nginx -o yaml

# Get YAML for any resource
k get deployment my-deployment -o yaml
k get service my-service -o yaml
k get namespace default -o yaml

# Get YAML for all pods
k get pods -o yaml
```

### Other Output Formats

```bash
# JSON format
k get pod nginx -o json

# Wide output (more columns)
k get pods -o wide

# Custom columns
k get pods -o custom-columns=NAME:.metadata.name,STATUS:.status.phase

# Just names
k get pods -o name

# YAML without managed fields (cleaner)
k get pod nginx -o yaml --export  # deprecated
```

---

## Editing Running Resources

### Edit Command

```bash
# Opens YAML in default editor (vim)
k edit pod httpd-zhivko

# Use specific editor
KUBE_EDITOR="nano" k edit pod httpd-zhivko
KUBE_EDITOR="code --wait" k edit pod httpd-zhivko
```

**Example: Adding a label**

```yaml
metadata:
  labels:
    hello: world
    app: myapp
```

After saving and closing the editor, verify:

```bash
k describe pod httpd-zhivko
# or
k get pod httpd-zhivko --show-labels
```

### âš ï¸ Important Notes About Editing

**In production environments:**
- `k edit` is **NOT common practice** - use GitOps/declarative manifests instead
- Changes with `k edit` are not tracked in version control
- Can lead to configuration drift

**For Kubernetes exams (CKA/CKAD):**
- `k edit` is **essential** for speed and efficiency
- Saves time compared to deleting and recreating resources

### What Can Be Edited?

**Not all fields can be edited on running pods!**

**Can be edited:**
- Labels
- Annotations
- Resource limits (in some cases)
- Active deadline seconds

**Cannot be edited** (immutable after creation):
- Container image
- Container command/args
- Volume mounts
- Most spec fields

**If you try to edit immutable fields:**
```bash
# Kubernetes will show error
error: pods "nginx" is invalid

# Workaround: Delete and recreate
k delete pod nginx
k create -f nginx.yaml

# Or use replace with force (deletes and recreates)
k replace -f nginx.yaml --force
```

---

## Dry Run - Generating YAML Templates

### What is Dry Run?

**Dry run** allows you to preview or generate YAML without actually creating resources.

### Dry Run Client

```bash
# Generate YAML without contacting API server
k run nginx-yaml --image=nginx --dry-run=client -o yaml
```

**Output:**
```yaml
apiVersion: v1
kind: Pod
metadata:
  labels:
    run: nginx-yaml
  name: nginx-yaml
spec:
  containers:
  - image: nginx
    name: nginx-yaml
    resources: {}
  dnsPolicy: ClusterFirst
  restartPolicy: Always
status: {}
```

**What happens:**
- Validates YAML structure on **client side** only
- Does **NOT** contact the API server
- Does **NOT** check if pod name already exists
- Fast and offline-capable

### Dry Run Server

```bash
# Validate on server side without persisting
k run nginx-yaml --image=nginx --dry-run=server -o yaml
```

**What happens:**
- Sends request to API server
- API server validates the request fully
- Checks for naming conflicts, quotas, admission controllers
- Does **NOT** persist to etcd
- Does **NOT** create or destroy the pod
- Just validates and returns what would be created

### Comparison Table

| Feature | `--dry-run=client` | `--dry-run=server` |
|---------|-------------------|-------------------|
| Contacts API server | âŒ No | âœ… Yes |
| Checks name conflicts | âŒ No | âœ… Yes |
| Validates against schema | âœ… Basic | âœ… Full |
| Runs admission controllers | âŒ No | âœ… Yes |
| Persists to etcd | âŒ No | âŒ No |
| Speed | âš¡ Faster | ðŸ¢ Slower |
| Requires cluster access | âŒ No | âœ… Yes |

---

## Creating YAML Templates

### Generate and Save to File

```bash
# Generate YAML template and save to file
k run nginx --image=nginx --dry-run=client -o yaml > nginx.yaml

# For deployments
k create deployment nginx --image=nginx --dry-run=client -o yaml > deployment.yaml

# For services
k create service clusterip my-service --tcp=80:80 --dry-run=client -o yaml > service.yaml

# For jobs
k create job my-job --image=busybox --dry-run=client -o yaml > job.yaml

# For cronjobs
k create cronjob my-cron --image=busybox --schedule="*/5 * * * *" --dry-run=client -o yaml > cronjob.yaml
```

### Edit the Generated Template

**Original generated file:**
```yaml
apiVersion: v1
kind: Pod
metadata:
  labels:
    run: nginx-yaml
  name: nginx-yaml
spec:
  containers:
  - image: nginx
    name: nginx-yaml
    resources: {}
  dnsPolicy: ClusterFirst
  restartPolicy: Always
status: {}
```

**After editing (cleaned up):**
```yaml
apiVersion: v1
kind: Pod
metadata:
  labels:
    method: fromcode
    run: nginx-yaml
  name: nginx-yaml
spec:
  containers:
  - image: nginx
    name: nginx-yaml
```

**What was removed:**
- `resources: {}` - empty, not needed
- `dnsPolicy: ClusterFirst` - default value
- `restartPolicy: Always` - default value
- `status: {}` - managed by Kubernetes, not needed in manifest

---

## Creating Resources from YAML

### Two Main Commands: `create` vs `apply`

#### kubectl create

```bash
k create -f nginx.yaml
```

**Characteristics:**
- **Imperative** command
- Creates resource if it doesn't exist
- **Fails** if resource already exists
- Does **NOT** update existing resources
- Does **NOT** track configuration history
- Faster for one-time operations

**Use cases:**
- Initial resource creation
- Quick one-off resources
- When you know resource doesn't exist

**Example:**
```bash
k create -f nginx.yaml
# Success: pod/nginx-yaml created

k create -f nginx.yaml
# Error: pods "nginx-yaml" already exists
```

#### kubectl apply

```bash
k apply -f nginx.yaml
```

**Characteristics:**
- **Declarative** command
- Creates resource if it doesn't exist
- **Updates** resource if it already exists
- Tracks configuration in annotations (`kubectl.kubernetes.io/last-applied-configuration`)
- Performs **three-way merge** (last applied, current spec, new spec)
- **Idempotent** - can run multiple times safely

**Use cases:**
- Production deployments
- GitOps workflows
- Continuous deployment
- When you want to update existing resources
- Best practice for declarative management

**Example:**
```bash
k apply -f nginx.yaml
# Success: pod/nginx-yaml created

# Edit nginx.yaml to add label
# Run again:
k apply -f nginx.yaml
# Success: pod/nginx-yaml configured
```

### Create vs Apply Comparison

| Feature | `k create` | `k apply` |
|---------|-----------|----------|
| Philosophy | Imperative | Declarative |
| Create new resource | âœ… Yes | âœ… Yes |
| Update existing resource | âŒ No | âœ… Yes |
| Fails if exists | âœ… Yes | âŒ No |
| Tracks config history | âŒ No | âœ… Yes |
| Three-way merge | âŒ No | âœ… Yes |
| Idempotent | âŒ No | âœ… Yes |
| Production best practice | âŒ No | âœ… Yes |
| Exam speed | âš¡ Faster | ðŸ¢ Slower |

### Other Related Commands

```bash
# Replace resource (deletes and recreates if needed)
k replace -f nginx.yaml

# Replace with force (always deletes and recreates)
k replace -f nginx.yaml --force

# Delete using YAML file
k delete -f nginx.yaml

# Apply entire directory
k apply -f ./manifests/

# Apply with recursive directories
k apply -f ./manifests/ -R

# Apply from URL
k apply -f https://example.com/manifest.yaml
```

---

## YAML File Structure

### Basic Pod YAML Structure

```yaml
apiVersion: v1              # API version (v1 for core resources)
kind: Pod                    # Resource type
metadata:                    # Metadata about the object
  name: my-pod              # Required: unique name
  namespace: default        # Optional: defaults to "default"
  labels:                   # Optional: key-value pairs for organization
    app: myapp
    environment: dev
  annotations:              # Optional: non-identifying metadata
    description: "My test pod"
spec:                       # Desired state specification
  containers:               # List of containers
  - name: nginx            # Container name
    image: nginx:latest    # Container image
    ports:                 # Optional: exposed ports
    - containerPort: 80
    env:                   # Optional: environment variables
    - name: ENV_VAR
      value: "my-value"
    resources:             # Optional: resource requests/limits
      requests:
        memory: "64Mi"
        cpu: "250m"
      limits:
        memory: "128Mi"
        cpu: "500m"
  restartPolicy: Always    # Optional: Always, OnFailure, Never
```

### Required Fields (for all resources)

```yaml
apiVersion: v1      # Required
kind: Pod          # Required
metadata:          # Required
  name: my-pod    # Required
spec:              # Required (except for some resources like namespace)
  # ... spec fields depend on kind
```

---

## Multiple Resources in One File

You can define multiple resources in a single YAML file using `---` separator:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod
spec:
  containers:
  - name: nginx
    image: nginx
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  selector:
    app: nginx
  ports:
  - port: 80
    targetPort: 80
```

```bash
# Apply all resources in file
k apply -f multi-resource.yaml

# Create all resources
k create -f multi-resource.yaml

# Delete all resources
k delete -f multi-resource.yaml
```

---

## Finding YAML Examples in Documentation

### Kubernetes Official Documentation

**Website:** https://kubernetes.io/docs/

### Quick Trick: Find YAML Blocks

1. Open Kubernetes documentation page
2. Press `Ctrl+F` (or `Cmd+F` on Mac)
3. Search for: **"apiVersion"**
4. This will highlight all YAML code blocks on the page

**Why this works:**
- Every Kubernetes YAML starts with `apiVersion`
- Quickly jump between YAML examples
- Skip prose and explanations

### Common Documentation Sections with YAMLs

- **Concepts** â†’ Shows example manifests
- **Tasks** â†’ Step-by-step with YAMLs
- **Reference** â†’ API documentation with all fields
- **Tutorials** â†’ Complete examples

### kubectl explain - Built-in Documentation

```bash
# Get field documentation
kubectl explain pod
kubectl explain pod.spec
kubectl explain pod.spec.containers
kubectl explain pod.spec.containers.resources

# Get all fields recursively
kubectl explain pod --recursive

# Get specific field documentation
kubectl explain deployment.spec.strategy
```

---

## Vim Tips for Editing YAML

### Paste Mode (Prevent Auto-Indent Issues)

When pasting YAML code into vim:

```vim
:set paste
```

Press Enter, then:
- Press `i` to enter insert mode
- Paste your YAML (Ctrl+V or Cmd+V)
- Press `Esc` to exit insert mode

```vim
:set nopaste
```

**Why is this needed?**
- Vim's auto-indent can mess up YAML indentation when pasting
- Paste mode disables auto-indent temporarily

### Other Useful Vim Commands for YAML

```vim
# Enable line numbers
:set number

# Enable relative line numbers
:set relativenumber

# Show whitespace characters (helpful for YAML indentation)
:set list

# Set tab width to 2 spaces (YAML standard)
:set tabstop=2
:set shiftwidth=2
:set expandtab

# Enable syntax highlighting
:syntax on

# Search and replace
:%s/old/new/g

# Delete line
dd

# Undo
u

# Redo
Ctrl+r

# Save and quit
:wq

# Quit without saving
:q!

# Go to line 20
:20

# Jump to end of file
G

# Jump to beginning of file
gg
```

### Set Vim as Default Editor

```bash
# Bash
echo 'export KUBE_EDITOR="vim"' >> ~/.bashrc
source ~/.bashrc

# Zsh
echo 'export KUBE_EDITOR="vim"' >> ~/.zshrc
source ~/.zshrc

# Use VS Code instead
export KUBE_EDITOR="code --wait"

# Use nano instead
export KUBE_EDITOR="nano"
```

---

## Key Takeaways

1. **All Kubernetes objects are YAML files** - Declarative configuration
2. **`k get -o yaml`** - View running resource definitions
3. **`k edit`** - Quick edits (exams), not for production
4. **`--dry-run=client`** - Generate YAML templates quickly (doesn't contact API)
5. **`--dry-run=server`** - Validate on server without creating (contacts API)
6. **`k create`** - Imperative, fails if exists (faster for exams)
7. **`k apply`** - Declarative, idempotent, production best practice
8. **`k replace --force`** - Delete and recreate when spec is immutable
9. **Search "apiVersion"** - Quick way to find YAML examples in docs
10. **`:set paste`** - Essential for pasting YAML into vim correctly

---

## Common Workflow

```bash
# 1. Generate template
k run myapp --image=nginx --dry-run=client -o yaml > myapp.yaml

# 2. Edit the YAML file
vim myapp.yaml

# 3. Apply to cluster
k apply -f myapp.yaml

# 4. Verify
k get pod myapp
k describe pod myapp

# 5. Make changes to YAML
vim myapp.yaml

# 6. Apply changes
k apply -f myapp.yaml

# 7. Clean up
k delete -f myapp.yaml
```

---

## Quick Reference Table

| Task | Command |
|------|---------|
| Get YAML of running pod | `k get pod nginx -o yaml` |
| Edit running pod | `k edit pod nginx` |
| Generate YAML template | `k run nginx --image=nginx --dry-run=client -o yaml > pod.yaml` |
| Create from YAML | `k create -f pod.yaml` |
| Apply from YAML | `k apply -f pod.yaml` |
| Delete from YAML | `k delete -f pod.yaml` |
| Replace resource | `k replace -f pod.yaml --force` |
| Validate YAML | `k apply -f pod.yaml --dry-run=server` |
| Explain resource fields | `k explain pod.spec` |