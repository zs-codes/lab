## Viewing Pods

### Basic Pod Listing

```bash
# List all pods in current namespace
k get pods

# Example output:
# NAME           READY   STATUS    RESTARTS   AGE
# httpd-zhivko   1/1     Running   0          22h
# nginx-docs     1/1     Running   0          16h
# nginx-yaml     1/1     Running   0          16h
# nginx-zhivko   1/1     Running   0          22h
```

**Column meanings:**
- **NAME** - Pod name (must be unique in namespace)
- **READY** - Containers ready / Total containers (e.g., `1/1` means 1 out of 1 ready)
- **STATUS** - Current pod state (Running, Pending, Failed, etc.)
- **RESTARTS** - Number of times containers have restarted
- **AGE** - Time since pod was created

### Detailed Pod Listing

```bash
# List pods with additional details
k get pods -o wide

# Example output:
# NAME           READY   STATUS    RESTARTS   AGE   IP           NODE                   NOMINATED NODE   READINESS GATES
# httpd-zhivko   1/1     Running   0          22h   10.42.0.15   lima-rancher-desktop   <none>           <none>
# nginx-docs     1/1     Running   0          16h   10.42.0.20   lima-rancher-desktop   <none>           <none>
# nginx-yaml     1/1     Running   0          16h   10.42.0.21   lima-rancher-desktop   <none>           <none>
# nginx-zhivko   1/1     Running   0          22h   10.42.0.14   lima-rancher-desktop   <none>           <none>
```

**Additional columns:**
- **IP** - Pod IP address (internal cluster IP)
- **NODE** - Which worker node the pod is running on
- **NOMINATED NODE** - Node nominated by scheduler (usually empty when running)
- **READINESS GATES** - Additional readiness checks (advanced feature)

### Other Useful Get Commands

```bash
# Show labels
k get pods --show-labels

# Filter by label
k get pods -l app=nginx
k get pods -l environment=production

# Watch pods in real-time
k get pods -w
k get pods -o wide -w

# Sort by creation time
k get pods --sort-by=.metadata.creationTimestamp

# Show pods from all namespaces
k get pods -A
k get pods --all-namespaces

# Show pods in specific namespace
k get pods -n kube-system

# Custom output columns
k get pods -o custom-columns=NAME:.metadata.name,IP:.status.podIP,NODE:.spec.nodeName
```

---

## Deleting Pods

### Basic Deletion

```bash
# Delete a single pod
k delete pod nginx-zhivko
# Output: pod "nginx-zhivko" deleted

# Delete multiple pods
k delete pod httpd-zhivko nginx-yaml
```

### Advanced Deletion Options

```bash
# Delete pod immediately (no grace period)
k delete pod nginx-zhivko --grace-period=0 --force

# Delete with custom grace period (default is 30 seconds)
k delete pod nginx-zhivko --grace-period=10

# Delete all pods in namespace
k delete pods --all

# Delete pods by label
k delete pods -l app=nginx

# Delete from YAML file
k delete -f pod.yaml

# Delete pod and wait for confirmation
k delete pod nginx-zhivko --wait=true

# Delete without waiting
k delete pod nginx-zhivko --wait=false
```

### Grace Period Explained

When you delete a pod:
1. Pod enters **Terminating** state
2. **SIGTERM** signal sent to containers (grace period starts, default 30s)
3. Containers should shut down gracefully
4. After grace period, **SIGKILL** sent (forceful termination)
5. Pod removed from cluster

```bash
# Check pod during termination
k get pods
# NAME           READY   STATUS        RESTARTS   AGE
# nginx-zhivko   1/1     Terminating   0          22h

# Force immediate deletion (use with caution!)
k delete pod nginx-zhivko --grace-period=0 --force
```

⚠️ **Warning**: `--force --grace-period=0` should only be used when:
- Pod is stuck in Terminating state
- Node is unreachable
- Testing/development environments
- **Never use in production without good reason!**

---

## Accessing Containers

### Interactive Shell Access

```bash
# Execute interactive bash shell in container
k exec -it nginx-docs -- /bin/bash

# Alternative shells
k exec -it nginx-docs -- /bin/sh
k exec -it nginx-docs -- /bin/zsh
k exec -it nginx-docs -- bash
```

**Flag meanings:**
- `-i` or `--stdin` - Keep stdin open (interactive)
- `-t` or `--tty` - Allocate a pseudo-TTY (terminal)
- `--` - Separates kubectl flags from container command
- `/bin/bash` - Command to execute in container

### Command Breakdown

```bash
k exec -it nginx-docs -- /bin/bash
```

1. **`k exec`** - Execute command in container
2. **`-it`** - Interactive terminal mode
3. **`nginx-docs`** - Pod name
4. **`--`** - End of kubectl flags
5. **`/bin/bash`** - Command to run (bash shell)

### Once Inside the Container

```bash
# You're now inside the container
root@nginx-docs:/# 

# Check current shell
root@nginx-docs:/# echo $SHELL
/bin/bash

# List directory contents
root@nginx-docs:/# ls
bin  boot  dev  etc  home  lib  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var

# Navigate to nginx config directory
root@nginx-docs:/# cd /etc/nginx/

# List nginx config files
root@nginx-docs:/etc/nginx# ls
conf.d  fastcgi_params  koi-utf  koi-win  mime.types  modules  nginx.conf  scgi_params  uwsgi_params  win-utf

# View nginx configuration
root@nginx-docs:/etc/nginx# cat nginx.conf

# Check nginx version
root@nginx-docs:/# nginx -v

# Check running processes
root@nginx-docs:/# ps aux

# Check environment variables
root@nginx-docs:/# env
```

### Exiting the Container

```bash
# Method 1: Type exit
root@nginx-docs:/# exit

# Method 2: Press Ctrl+D
root@nginx-docs:/# [Ctrl+D]

# Both return you to your local terminal
zhivko.simeonov@macbook-pro lab %
```

---

## Non-Interactive Commands

You can also run commands without entering interactive mode:

```bash
# Run single command
k exec nginx-docs -- ls /etc/nginx

# Check nginx version
k exec nginx-docs -- nginx -v

# View file contents
k exec nginx-docs -- cat /etc/nginx/nginx.conf

# Check processes
k exec nginx-docs -- ps aux

# Check environment variables
k exec nginx-docs -- env

# Run multiple commands using shell
k exec nginx-docs -- sh -c "ls -la && pwd && whoami"

# Get pod hostname
k exec nginx-docs -- hostname

# Check disk usage
k exec nginx-docs -- df -h

# Check memory
k exec nginx-docs -- free -m
```

---

## Multi-Container Pods

When a pod has multiple containers, specify which container:

```bash
# Specify container with -c flag
k exec -it my-pod -c nginx-container -- /bin/bash

# List containers in pod
k get pod my-pod -o jsonpath='{.spec.containers[*].name}'

# Example with sidecar pattern
k exec -it my-app -c main-app -- /bin/bash
k exec -it my-app -c sidecar-log-collector -- /bin/sh
```

If you don't specify `-c container-name`, kubectl uses the first container in the pod.

---

## Common Use Cases for Exec

### 1. Check Operating System

```bash
k exec -it nginx-docs -- /bin/bash

# Check OS version
root@nginx-docs:/# cat /etc/os-release
root@nginx-docs:/# uname -a
root@nginx-docs:/# cat /etc/issue

# Check architecture
root@nginx-docs:/# ``arch``
```

### 2. Install Packages (Temporary)

```bash
k exec -it nginx-docs -- /bin/bash

# For Debian/Ubuntu based images
root@nginx-docs:/# apt update
root@nginx-docs:/# apt install -y curl wget vim

# For Alpine based images
root@nginx-docs:/# apk update
root@nginx-docs:/# apk add curl wget vim

# For RedHat/CentOS based images
root@nginx-docs:/# yum install -y curl wget vim
```

⚠️ **Important Notes:**
- Packages installed this way are **temporary**
- They **disappear** when container restarts
- For permanent changes, build a new Docker image
- Useful for debugging, not for production changes

**Example: Package repository issue (Debian Stretch EOL)**

```bash
root@nginx-docs:/etc/nginx# apt update

# Error: 404 Not Found
# Debian Stretch is End of Life (EOL)
# Repositories no longer available

# Solution: Use archive repositories or update base image
```

### 3. Ping Other Pods

```bash
k exec -it nginx-docs -- /bin/bash

# Install ping (if not available)
root@nginx-docs:/# apt update && apt install -y iputils-ping

# Ping another pod by IP
root@nginx-docs:/# ping 10.42.0.21
PING 10.42.0.21 (10.42.0.21) 56(84) bytes of data.
64 bytes from 10.42.0.21: icmp_seq=1 ttl=64 time=0.045 ms

# Ping another pod by service name
root@nginx-docs:/# ping nginx-service
PING nginx-service.default.svc.cluster.local (10.43.x.x) 56(84) bytes of data.

# Test DNS resolution
root@nginx-docs:/# nslookup nginx-service
```

### 4. Curl Other Pods/Services

```bash
k exec -it nginx-docs -- /bin/bash

# Install curl (if not available)
root@nginx-docs:/# apt update && apt install -y curl

# Curl another pod by IP
root@nginx-docs:/# curl http://10.42.0.21

# Curl a service
root@nginx-docs:/# curl http://nginx-service

# Curl with full DNS name
root@nginx-docs:/# curl http://nginx-service.default.svc.cluster.local

# Curl external website
root@nginx-docs:/# curl https://google.com

# Test specific port
root@nginx-docs:/# curl http://nginx-service:8080

# Get headers only
root@nginx-docs:/# curl -I http://nginx-service

# Verbose output
root@nginx-docs:/# curl -v http://nginx-service
```

### 5. Monitor the Container

```bash
k exec -it nginx-docs -- /bin/bash

# Check running processes
root@nginx-docs:/# ps aux
root@nginx-docs:/# top

# Check resource usage
root@nginx-docs:/# free -m
root@nginx-docs:/# df -h

# Check network connections
root@nginx-docs:/# netstat -tulpn
root@nginx-docs:/# ss -tulpn

# Check listening ports
root@nginx-docs:/# netstat -an | grep LISTEN

# View logs
root@nginx-docs:/# tail -f /var/log/nginx/access.log
root@nginx-docs:/# tail -f /var/log/nginx/error.log

# Check environment variables
root@nginx-docs:/# env | grep -i nginx

# Check application config
root@nginx-docs:/# cat /etc/nginx/nginx.conf
```

### 6. Debug Application Issues

```bash
k exec -it nginx-docs -- /bin/bash

# Test if application is responding
root@nginx-docs:/# curl localhost:80

# Check application logs
root@nginx-docs:/# ls /var/log/
root@nginx-docs:/# tail -100 /var/log/nginx/error.log

# Check if port is listening
root@nginx-docs:/# netstat -an | grep 80

# Test DNS resolution
root@nginx-docs:/# nslookup kubernetes.default
root@nginx-docs:/# dig kubernetes.default

# Check file permissions
root@nginx-docs:/# ls -la /etc/nginx/

# Validate configuration
root@nginx-docs:/# nginx -t
```

### 7. Copy Files (Alternative to exec)

```bash
# Copy file from pod to local
k cp nginx-docs:/etc/nginx/nginx.conf ./nginx.conf

# Copy file from local to pod
k cp ./myfile.txt nginx-docs:/tmp/myfile.txt

# Copy from specific container
k cp nginx-docs:/etc/nginx/nginx.conf ./nginx.conf -c nginx-container

# Copy entire directory
k cp nginx-docs:/etc/nginx/ ./nginx-config/
```

---

## Troubleshooting Common Issues

### Issue 1: Shell Not Found

```bash
k exec -it nginx-docs -- /bin/bash
# Error: executable file not found in $PATH

# Solution: Try /bin/sh instead (Alpine images)
k exec -it nginx-docs -- /bin/sh
```

### Issue 2: Pod Not Ready

```bash
k exec -it nginx-docs -- /bin/bash
# Error: pod not ready

# Check pod status
k get pod nginx-docs
k describe pod nginx-docs

# Wait for pod to be ready
k wait --for=condition=ready pod/nginx-docs --timeout=60s
```

### Issue 3: Multiple Containers

```bash
k exec -it multi-container-pod -- /bin/bash
# Error: pod has multiple containers, must specify container name

# Solution: Specify container with -c
k exec -it multi-container-pod -c nginx -- /bin/bash
```

### Issue 4: Permission Denied

```bash
k exec -it nginx-docs -- /bin/bash
# Error: permission denied

# Check pod security context
k get pod nginx-docs -o yaml | grep -A 5 securityContext

# Some containers run as non-root user
# You may have limited permissions
```

---

## Security Considerations

### Running as Non-Root

```bash
# Check current user inside container
k exec nginx-docs -- whoami
# Output: nginx (not root)

# Check user ID
k exec nginx-docs -- id
# Output: uid=101(nginx) gid=101(nginx) groups=101(nginx)
```

**Best Practices:**
- Containers should run as non-root when possible
- Use `securityContext` to enforce user ID
- Limit privileges with security contexts
- Use read-only root filesystems when possible

### Pod Security Standards

```yaml
# Example: Run container as non-root
apiVersion: v1
kind: Pod
metadata:
  name: secure-pod
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
  containers:
  - name: nginx
    image: nginx
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
        - ALL
```

---

## Exec vs Logs vs Port-Forward

### When to Use Each

| Task | Command | Use Case |
|------|---------|----------|
| View logs | `k logs pod-name` | Check application output |
| Follow logs | `k logs -f pod-name` | Real-time log monitoring |
| Interactive debugging | `k exec -it pod-name -- /bin/bash` | Explore container filesystem, run commands |
| Test application locally | `k port-forward pod-name 8080:80` | Access pod from localhost |
| Single command | `k exec pod-name -- ls` | Run one-off command |

### Examples

```bash
# View logs
k logs nginx-docs
k logs -f nginx-docs --tail=50

# Port forward to access application
k port-forward nginx-docs 8080:80
# Now access: http://localhost:8080

# Execute command
k exec nginx-docs -- nginx -v

# Interactive session
k exec -it nginx-docs -- /bin/bash
```

---

## Practical Example: Full Debugging Workflow

```bash
# 1. List pods
k get pods -o wide

# 2. Check pod details
k describe pod nginx-docs

# 3. Check logs
k logs nginx-docs --tail=50

# 4. Enter container
k exec -it nginx-docs -- /bin/bash

# 5. Inside container - install tools
root@nginx-docs:/# apt update && apt install -y curl iputils-ping

# 6. Test connectivity to another pod
root@nginx-docs:/# ping 10.42.0.21
root@nginx-docs:/# curl http://10.42.0.21

# 7. Check application
root@nginx-docs:/# curl localhost:80
root@nginx-docs:/# nginx -t

# 8. Check processes
root@nginx-docs:/# ps aux | grep nginx

# 9. Check ports
root@nginx-docs:/# netstat -tulpn

# 10. Exit
root@nginx-docs:/# exit

# 11. Copy config for analysis
k cp nginx-docs:/etc/nginx/nginx.conf ./nginx.conf

# 12. View from outside
cat nginx.conf
```

---

## Key Takeaways

1. **`k get pods`** - Basic pod listing
2. **`k get pods -o wide`** - Includes IP addresses and node information
3. **`k delete pod <name>`** - Delete pod (30s grace period by default)
4. **`k exec -it <pod> -- /bin/bash`** - Interactive shell access
5. **Ctrl+D or `exit`** - Exit container shell
6. **Multi-container pods** - Use `-c <container-name>` flag
7. **Temporary changes** - Packages installed via exec disappear on restart
8. **Security** - Containers should run as non-root when possible
9. **Debugging** - Exec is powerful for troubleshooting, but not for permanent changes
10. **Production** - Avoid exec in production; use logs, metrics, and tracing instead

---

## Quick Reference

| Task | Command |
|------|---------|
| List pods | `k get pods` |
| List with details | `k get pods -o wide` |
| Delete pod | `k delete pod <name>` |
| Force delete | `k delete pod <name> --grace-period=0 --force` |
| Interactive shell | `k exec -it <pod> -- /bin/bash` |
| Run command | `k exec <pod> -- <command>` |
| Specific container | `k exec -it <pod> -c <container> -- /bin/bash` |
| Copy file out | `k cp <pod>:/path/file ./file` |
| Copy file in | `k cp ./file <pod>:/path/file` |
| View logs | `k logs <pod>` |
| Follow logs | `k logs -f <pod>` |
| Port forward | `k port-forward <pod> 8080:80` |